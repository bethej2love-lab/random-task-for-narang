<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>í•  ì¼ ëœë¤ ë½‘ê¸°</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;
      background: #0b1720;
      color: #f5f5f5;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    .card {
      width: 100%;
      max-width: 420px;
      background: radial-gradient(circle at top, #1f3b4d 0, #0b1720 55%, #050b10 100%);
      border-radius: 24px;
      padding: 24px 20px 20px;
      box-shadow: 0 18px 40px rgba(0,0,0,0.5);
      position: relative;
      overflow: hidden;
    }
    .card::before {
      content: "";
      position: absolute;
      inset: -40%;
      background:
        radial-gradient(circle at 0 0, rgba(114, 232, 205, 0.12), transparent 60%),
        radial-gradient(circle at 100% 0, rgba(93, 188, 255, 0.16), transparent 55%);
      opacity: 0.9;
      z-index: -1;
    }
    h1 {
      font-size: 22px;
      text-align: center;
      margin-bottom: 16px;
      letter-spacing: 0.04em;
    }
    #result-box {
      margin-top: 12px;
      margin-bottom: 14px;
      padding: 14px 12px;
      border-radius: 16px;
      background: rgba(5, 12, 18, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.05);
      min-height: 72px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      text-align: center;
      gap: 4px;
    }
    #result {
      font-size: 19px;
      font-weight: 600;
    }
    #meta {
      font-size: 11px;
      color: #c5deff;
    }
    #hint {
      font-size: 12px;
      color: #c2c2c2;
      margin-top: 4px;
    }

    #main-button {
      width: 100%;
      margin-top: 10px;
      padding: 13px 12px;
      border-radius: 999px;
      border: none;
      font-size: 16px;
      font-weight: 600;
      background: linear-gradient(135deg, #4ade80, #22c55e);
      color: #021310;
      cursor: pointer;
      box-shadow: 0 10px 25px rgba(34, 197, 94, 0.55);
      transition: transform 0.08s ease, box-shadow 0.08s ease, opacity 0.2s ease;
    }
    #main-button:active {
      transform: translateY(1px);
      box-shadow: 0 3px 12px rgba(34, 197, 94, 0.7);
    }
    #main-button.disabled {
      opacity: 0.7;
      cursor: default;
      box-shadow: none;
    }

    .actions {
      display: none;
      margin-top: 10px;
      display: flex;
      gap: 8px;
    }
    .actions button {
      flex: 1;
      padding: 8px 6px;
      border-radius: 999px;
      border: none;
      font-size: 13px;
      cursor: pointer;
      transition: transform 0.08s ease, box-shadow 0.08s ease, background 0.15s ease;
    }
    .btn-done {
      background: linear-gradient(135deg, #38bdf8, #22c55e);
      color: #021018;
      box-shadow: 0 8px 18px rgba(56, 189, 248, 0.35);
      font-weight: 600;
    }
    .btn-done:active {
      transform: translateY(1px);
      box-shadow: 0 3px 10px rgba(56, 189, 248, 0.7);
    }
    .btn-skip {
      background: rgba(148, 163, 184, 0.18);
      color: #e5e7eb;
      border: 1px solid rgba(148, 163, 184, 0.4);
    }
    .btn-skip:active {
      transform: translateY(1px);
      background: rgba(148, 163, 184, 0.28);
    }

    .status {
      margin-top: 16px;
      border-top: 1px solid rgba(148, 163, 184, 0.35);
      padding-top: 10px;
      font-size: 12px;
      display: none;
    }
    .status-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 4px;
    }
    .status-header strong {
      font-size: 13px;
    }
    .status-header span {
      color: #9ca3af;
      font-size: 11px;
    }
    .task-list {
      list-style: none;
      margin-top: 5px;
      max-height: 140px;
      overflow-y: auto;
      padding-right: 4px;
    }
    .task-item {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 4px 2px;
    }
    .task-item span.name {
      flex: 1;
    }
    .task-item span.grade {
      font-size: 10px;
      color: #9ca3af;
    }
    .task-item span.coin {
      font-size: 10px;
      color: #facc15;
    }
    .checkbox {
      width: 16px;
      height: 16px;
      border-radius: 4px;
      border: 1px solid rgba(148, 163, 184, 0.8);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      color: #0b1720;
      background: transparent;
    }
    .task-item.done .checkbox {
      background: #22c55e;
      border-color: #22c55e;
      color: #022c22;
    }
    .task-item.done span.name {
      text-decoration: line-through;
      color: #9ca3af;
    }

    .progress-row {
      margin-top: 6px;
      display: flex;
      justify-content: space-between;
      font-size: 11px;
      color: #d1d5db;
    }
    .bar-wrap {
      margin-top: 4px;
      width: 100%;
      height: 6px;
      border-radius: 999px;
      background: rgba(31, 41, 55, 0.8);
      overflow: hidden;
    }
    .bar-fill {
      height: 100%;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(90deg, #22c55e, #38bdf8);
      transition: width 0.2s ease;
    }

    .year-progress {
      margin-top: 8px;
      padding: 6px 8px;
      border-radius: 12px;
      background: rgba(15, 23, 42, 0.8);
      font-size: 11px;
      color: #e5e7eb;
      display: flex;
      flex-direction: column;
      gap: 3px;
    }
    .year-progress span.label {
      color: #9ca3af;
    }
    .level-badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(56, 189, 248, 0.16);
      font-size: 11px;
      color: #bae6fd;
    }

    .note {
      margin-top: 10px;
      font-size: 10px;
      color: #64748b;
      text-align: center;
    }

    .grade-tag {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .grade-pill {
      border-radius: 999px;
      padding: 1px 6px;
      font-size: 9px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      color: #e5e7eb;
    }
    .grade-S .grade-pill { border-color: #f97316; color: #fed7aa; }
    .grade-A .grade-pill { border-color: #38bdf8; color: #bae6fd; }
    .grade-B .grade-pill { border-color: #9ca3af; color: #e5e7eb; }
    .grade-BONUS .grade-pill { border-color: #a855f7; color: #e9d5ff; }

    .glow {
      animation: glowPulse 1.2s ease-out;
    }
    @keyframes glowPulse {
      0% { box-shadow: 0 0 0 rgba(250, 204, 21, 0.0); }
      35% { box-shadow: 0 0 25px rgba(250, 204, 21, 0.55); }
      100% { box-shadow: 0 0 0 rgba(250, 204, 21, 0.0); }
    }

    .hidden {
      display: none !important;
    }
  </style>
</head>
<body>
  <div class="card" id="card">
    <h1>í•  ì¼ ëœë¤ ë½‘ê¸°</h1>

    <div id="result-box">
      <div id="result">ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹œì‘!</div>
      <div id="meta"></div>
      <div id="hint"></div>
    </div>

    <button id="main-button" onclick="pickRandom()">ì§€ê¸ˆ ë‹¹ì¥ ì´ê±°!</button>

    <div class="actions hidden" id="action-buttons">
      <button class="btn-done" onclick="markDone()">ì™„ë£Œ</button>
      <button class="btn-skip" onclick="skipTask()">ë³´ë¥˜</button>
    </div>

    <div class="status hidden" id="status">
      <div class="status-header">
        <strong>ì˜¤ëŠ˜ ì§„í–‰ ìƒí™©</strong>
        <span><span id="done-count">0</span> / <span id="total-count">0</span> ì™„ë£Œ Â· ì½”ì¸ <span id="coin-count">0</span>ê°œ</span>
      </div>
      <ul class="task-list" id="task-list"></ul>

      <div class="progress-row">
        <span>ì˜¤ëŠ˜ ì²´í¬</span>
        <span id="progress-label">0%</span>
      </div>
      <div class="bar-wrap">
        <div class="bar-fill" id="bar-fill"></div>
      </div>

      <div class="year-progress">
        <span class="label">ì˜¬í•´ ì „ì²´ ì§„í–‰</span>
        <span>ì™„ì „ í´ë¦¬ì–´í•œ ë‚ : <span id="perfect-days">0</span>ì¼ / 365ì¼ (<span id="perfect-percent">0</span>%)</span>
        <span>í˜„ì¬ ë ˆë²¨: <span class="level-badge">Lv. <span id="level">1</span></span></span>
      </div>
    </div>

    <div class="note">
      ì™„ë£Œë¥¼ ëˆ„ë¥´ë©´ ì˜¤ëŠ˜ì€ ê·¸ ë¯¸ì…˜ì´ ë‹¤ì‹œ ë‚˜ì˜¤ì§€ ì•Šì•„ìš”.
    </div>
  </div>

  <script>
    const TASKS = [
      {
        name: "ë‹¬ë¦¬ê¸°",
        hint: "â†’ 5ë¶„ë§Œ ë›°ì–´ë„, ê±¸ì–´ë„ ê´œì°®ì•„",
        grade: "S",
        coins: 3
      },
      {
        name: "ë¸”ë¡œê·¸ ì—…ë¡œë“œ",
        hint: "â†’ ì§§ì•„ë„ ì¢‹ìœ¼ë‹ˆê¹Œ ì˜¤ëŠ˜ í•˜ë‚˜ë§Œ!",
        grade: "S",
        coins: 3
      },
      {
        name: "ë¶€ê¸°ìŠ¤ ì ê²€",
        hint: "â†’ ì±… ë“±ë¡ / ë¸”ë¡œê·¸ ì—…ë¡œë“œ / ë¦¬ë·° ë‹µê¸€ ë­ë“ !",
        grade: "S",
        coins: 3
      },
      {
        name: "ì±… í•œ í˜ì´ì§€ ì½ê¸°",
        hint: "â†’ ë”± í•œ í˜ì´ì§€ë§Œ! ë” ì½ê³  ì‹¶ìœ¼ë©´ ë³´ë„ˆìŠ¤ ğŸ",
        grade: "A",
        coins: 2
      },
      {
        name: "CBT ë¬¸ì œ í’€ê¸°",
        hint: "â†’ ìê²©ì¦ ë”°ì•¼ì œ.. í•œ ì„¸íŠ¸ë§Œ í’€ì–´ë³´ì",
        grade: "A",
        coins: 2
      },
      {
        name: "í”Œë­í¬ 1ë¶„",
        hint: "â†’ í˜ë“¤ë©´ 30ì´ˆ x 2ë„ ì¸ì •!",
        grade: "A",
        coins: 2
      },
      {
        name: "brilliant",
        hint: "â†’ í•œ ì½”ìŠ¤ë§Œ í’€ì–´ë³´ê³  ì¢…ë£Œ!",
        grade: "B",
        coins: 1
      },
      {
        name: "ê°„ë‹¨ ìŠ¤íŠ¸ë ˆì¹­",
        hint: "â†’ ì–´ê¹¨, ëª©ë§Œì´ë¼ë„ ì­‰ì­‰ í´ê¸°",
        grade: "B",
        coins: 1
      },
      {
        name: "ë“€ì˜¤ë§ê³ ",
        hint: "â†’ ì˜¤ëŠ˜ì˜ ìŠ¤í‹±ë§Œ ì±„ìš°ê¸°",
        grade: "B",
        coins: 1
      },
      {
        name: "ê¿ˆì˜ ì§‘",
        hint: "â†’ ì–í˜¸ âœ¨",
        grade: "BONUS",
        coins: 0
      }
    ];

    const STORAGE_KEY_DAY = "randomTaskState_v1";
    const STORAGE_KEY_YEAR = "randomTaskYear_v1";

    const today = new Date();
    const todayStr = today.toISOString().slice(0, 10);
    const currentYear = today.getFullYear();

    let dayState = null;
    let yearState = null;
    let currentTask = null;
    let hasShownStatus = false;

    function initDayState() {
      const tasksState = {};
      TASKS.forEach(t => {
        tasksState[t.name] = { done: false };
      });
      return {
        date: todayStr,
        tasks: tasksState,
        coins: 0,
        perfectRecorded: false
      };
    }

    function loadState() {
      try {
        const savedDay = localStorage.getItem(STORAGE_KEY_DAY);
        if (savedDay) {
          const parsed = JSON.parse(savedDay);
          if (parsed.date === todayStr) {
            dayState = parsed;
          } else {
            dayState = initDayState();
          }
        } else {
          dayState = initDayState();
        }
      } catch (e) {
        dayState = initDayState();
      }

      try {
        const savedYear = localStorage.getItem(STORAGE_KEY_YEAR);
        if (savedYear) {
          const parsedYear = JSON.parse(savedYear);
          if (parsedYear.year === currentYear) {
            yearState = parsedYear;
          } else {
            yearState = { year: currentYear, perfectDays: 0 };
          }
        } else {
          yearState = { year: currentYear, perfectDays: 0 };
        }
      } catch (e) {
        yearState = { year: currentYear, perfectDays: 0 };
      }
    }

    function saveState() {
      try {
        localStorage.setItem(STORAGE_KEY_DAY, JSON.stringify(dayState));
        localStorage.setItem(STORAGE_KEY_YEAR, JSON.stringify(yearState));
      } catch (e) {
        console.warn("ì €ì¥ì— ì‹¤íŒ¨í–ˆì–´ìš” (ë¸Œë¼ìš°ì € ì„¤ì •ì¼ ìˆ˜ ìˆìŒ)", e);
      }
    }

    function pickRandom() {
      const btn = document.getElementById("main-button");
      const resultEl = document.getElementById("result");
      const metaEl = document.getElementById("meta");
      const hintEl = document.getElementById("hint");
      const cardEl = document.getElementById("card");
      const actions = document.getElementById("action-buttons");
      const status = document.getElementById("status");

      btn.classList.add("disabled");
      btn.disabled = true;

      resultEl.textContent = "ê³ ë¯¼ì¤‘â€¦";
      metaEl.textContent = "";
      hintEl.textContent = "";

      // 2ì´ˆ ê¸°ë‹¤ë ¸ë‹¤ê°€ ê²°ê³¼ í‘œì‹œ
      setTimeout(() => {
        const available = TASKS.filter(t => !dayState.tasks[t.name].done || t.coins === 0);
        const pool = available.length > 0 ? available : TASKS;
        const index = Math.floor(Math.random() * pool.length);
        const choice = pool[index];
        currentTask = choice;

        resultEl.textContent = choice.name;
        hintEl.textContent = choice.hint;

        const gradeText = choice.grade === "BONUS" ? "ë³´ë„ˆìŠ¤" : (choice.grade + "ê¸‰");
        const coinText = choice.coins > 0 ? `Â· ì½”ì¸ ${choice.coins}ê°œ` : "Â· ì½”ì¸ ì—†ìŒ (ê·¸ëƒ¥ ì¦ê¸°ê¸°)";
        metaEl.innerHTML = `<span class="grade-tag grade-${choice.grade}">
          <span class="grade-pill">${gradeText}</span>
          <span style="font-size:11px;">${coinText}</span>
        </span>`;

        // Sê¸‰ì´ë©´ ì‚´ì§ ë°˜ì§ì´ëŠ” íš¨ê³¼
        if (choice.grade === "S") {
          document.getElementById("card").classList.remove("glow");
          void cardEl.offsetWidth;
          document.getElementById("card").classList.add("glow");
        }

        actions.classList.remove("hidden");
        status.classList.remove("hidden");
        hasShownStatus = true;

        btn.classList.remove("disabled");
        btn.disabled = false;

        renderUI();
      }, 2000);
    }

    function markDone() {
      if (!currentTask) return;
      const name = currentTask.name;
      const taskState = dayState.tasks[name];

      if (!taskState.done) {
        taskState.done = true;
        dayState.coins += currentTask.coins || 0;
      }

      const doneCount = getDoneCount();
      if (doneCount === TASKS.length && !dayState.perfectRecorded) {
        dayState.perfectRecorded = true;
        yearState.perfectDays += 1;
      }

      saveState();
      renderUI();
    }

    function skipTask() {
      currentTask = null;
      const resultEl = document.getElementById("result");
      const metaEl = document.getElementById("meta");
      const hintEl = document.getElementById("hint");

      resultEl.textContent = "ë‹¤ë¥¸ ê±° í•œ ë²ˆ ë” ë½‘ì•„ë³¼ê¹Œ?";
      metaEl.textContent = "";
      hintEl.textContent = "";
    }

    function getDoneCount() {
      return TASKS.reduce((acc, t) => acc + (dayState.tasks[t.name].done ? 1 : 0), 0);
    }

    function renderUI() {
      document.getElementById("total-count").textContent = TASKS.length;
      document.getElementById("coin-count").textContent = dayState.coins;

      const doneCount = getDoneCount();
      document.getElementById("done-count").textContent = doneCount;

      const progressPercent = Math.round((doneCount / TASKS.length) * 100);
      document.getElementById("progress-label").textContent = progressPercent + "%";
      document.getElementById("bar-fill").style.width = progressPercent + "%";

      const listEl = document.getElementById("task-list");
      listEl.innerHTML = "";
      TASKS.forEach(t => {
        const li = document.createElement("li");
        li.className = "task-item" + (dayState.tasks[t.name].done ? " done" : "");
        li.innerHTML = `
          <div class="checkbox">${dayState.tasks[t.name].done ? "âœ“" : ""}</div>
          <span class="name">${t.name}</span>
          <span class="grade">${t.grade === "BONUS" ? "ë³´ë„ˆìŠ¤" : t.grade + "ê¸‰"}</span>
          <span class="coin">${t.coins > 0 ? t.coins + "ì½”ì¸" : ""}</span>
        `;
        listEl.appendChild(li);
      });

      const perfectDaysEl = document.getElementById("perfect-days");
      const perfectPercentEl = document.getElementById("perfect-percent");
      const levelEl = document.getElementById("level");

      const perfectDays = yearState.perfectDays || 0;
      const percent = Math.round((perfectDays / 365) * 1000) / 10;

      perfectDaysEl.textContent = perfectDays;
      perfectPercentEl.textContent = percent.toFixed(1);

      const level = Math.min(10, Math.max(1, Math.floor(perfectDays / 36.5) + 1));
      levelEl.textContent = level;
    }

    document.addEventListener("DOMContentLoaded", () => {
      loadState();
      renderUI();
      // ì²« í™”ë©´ì—ì„œëŠ” ì§„í–‰ ìƒí™©ì„ ìˆ¨ê²¨ë‘ê³  ì²« ë¯¸ì…˜ì„ ë½‘ì€ ë’¤ì—ë§Œ ë³´ì—¬ì£¼ê³  ì‹¶ë‹¤ë©´
      // ì—¬ê¸°ì„œëŠ” ê·¸ëƒ¥ ìˆ¨ê²¨ë‘” ìƒíƒœë¡œ ë‘ê³ , pickRandom() ì•ˆì—ì„œë§Œ statusë¥¼ ë³´ì´ê²Œ í•˜ê³  ìˆì–´.
    });
  </script>
</body>
</html>
