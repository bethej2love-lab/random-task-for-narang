<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>í•  ì¼ ëœë¤ ë½‘ê¸°</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      margin: 0;
      padding-top: 40px;
      background: #f4f4f4;
      transition: background 0.3s ease;
    }
    .card {
      background: #ffffff;
      padding: 24px 32px;
      border-radius: 16px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
      text-align: center;
      max-width: 380px;
      width: 90%;
      transition: background 0.3s ease;
    }
    h1 {
      font-size: 20px;
      margin-bottom: 8px;
    }
    .theme-label {
      font-size: 18px;
      margin-bottom: 20px;
    }
    #result {
      font-size: 22px;
      font-weight: 700;
      margin: 20px 0 8px;
      min-height: 32px;
    }
    #hint {
      font-size: 12px;
      color: #666;
      margin-bottom: 16px;
      min-height: 16px;
    }
    button.main {
      padding: 12px 20px;
      font-size: 16px;
      border: none;
      border-radius: 999px;
      cursor: pointer;
      background: #4b8cff;
      color: white;
      font-weight: 600;
      width: 100%;
      transition: transform 0.05s ease, opacity 0.1s ease, background 0.2s ease;
    }
    button.main:active {
      transform: scale(0.97);
      opacity: 0.9;
    }
    button.main:disabled {
      opacity: 0.6;
      cursor: default;
      background: #8faefc;
    }
    .action-buttons {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-top: 8px;
      margin-bottom: 12px;
    }
    .action-buttons button {
      flex: 1;
      padding: 10px 0;
      border-radius: 8px;
      border: none;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
    }
    .complete-btn {
      background: #2ecc71;
      color: white;
    }
    .pending-btn {
      background: #e0e0e0;
      color: #333;
    }
    .progress-box {
      margin-top: 20px;
      text-align: left;
      font-size: 14px;
    }
    .status-summary {
      font-size: 13px;
      margin-bottom: 6px;
      text-align: right;
      color: #444;
    }
    .progress-bar {
      margin-top: 4px;
      font-size: 18px;
      letter-spacing: 2px;
      text-align: center;
    }
    .checkbox-list {
      margin-top: 12px;
      font-size: 14px;
    }
    .checkbox-list div {
      margin-bottom: 6px;
    }
    .streak-box {
      margin-top: 16px;
      font-size: 13px;
    }
    .streak-bar {
      margin-top: 4px;
      width: 100%;
      height: 10px;
      border-radius: 999px;
      background: #e0e0e0;
      overflow: hidden;
    }
    .streak-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #4b8cff, #2ecc71);
      transition: width 0.3s ease;
    }
    #eventText {
      margin-top: 10px;
      font-size: 12px;
      color: #555;
    }
    .s-glow {
      color: #e67e22;
      text-shadow: 0 0 6px rgba(255, 215, 0, 0.9);
      animation: sPulse 0.8s ease-in-out 2;
    }
    @keyframes sPulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.06); }
      100% { transform: scale(1); }
    }
    .tier-label {
      display: inline-block;
      font-size: 11px;
      font-weight: 600;
      color: #999;
      border: 1px solid #ddd;
      padding: 2px 6px;
      border-radius: 999px;
      margin-right: 6px;
      vertical-align: middle;
    }
  </style>
</head>
<body>
  <div class="card" id="card">
    <h1>í•  ì¼ ëœë¤ ë½‘ê¸°</h1>
    <div class="theme-label" id="themeLabel"></div>

    <button class="main" id="pickButton" onclick="pickRandom()">ì§€ê¸ˆ ë‹¹ì¥ ì´ê±°!</button>

    <div id="result">ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹œì‘!</div>
    <div id="hint"></div>

    <div class="action-buttons" style="display:none;" id="actionButtons">
      <button class="complete-btn" onclick="markComplete()">ì™„ë£Œ</button>
      <button class="pending-btn" onclick="hideButtons()">ë³´ë¥˜</button>
    </div>

    <!-- ì§„í–‰ë„ + ì²´í¬ë¦¬ìŠ¤íŠ¸ + ì—°ê°„ í¼ì„¼íŠ¸ (ì²« í™”ë©´ì—ì„œëŠ” ì•ˆ ë³´ì„) -->
    <div class="progress-box" id="progressContainer" style="display:none;">
      <div class="status-summary" id="statusSummary">ì½”ì¸: 0ê°œ Â· LV 1</div>

      <div id="progressText">ì˜¤ëŠ˜ ì™„ë£Œ: 0 / 7</div>
      <div class="progress-bar" id="progressBar">â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹â—‹</div>
      <div class="checkbox-list" id="checkboxList"></div>

      <div class="streak-box">
        <div id="streakText">ì˜¬í•´ ì „ë¶€ ë‹¤ í•œ ë‚ : 0ì¼ / 365ì¼ (0.0%)</div>
        <div class="streak-bar">
          <div class="streak-fill" id="streakFill"></div>
        </div>
      </div>

      <div id="eventText"></div>
    </div>
  </div>

  <script>
    const tasks = [
      "ë“€ì˜¤ë§ê³ ",
      "Brilliant",
      "ì±… ì½ê¸°",
      "í”Œë­í¬ 1ë¶„+ê°„ë‹¨ ìŠ¤íŠ¸ë ˆì¹­",
      "ë¶€ê¸°ìŠ¤/ë¸”ë¡œê·¸",
      "ë‹¬ë¦¬ê¸°",
      "CBT ë¬¸ì œ í’€ê¸°"
    ];

    const hints = {
      "ë“€ì˜¤ë§ê³ ": "â†’ ì˜ì–´ ë ˆìŠ¨ ì™„ì£¼ë¥¼ í–¥í•´",
      "Brilliant": "â†’ 3ê°œ ì´ìƒ í‘¸ì‹­ì‡¼",
      "ì±… ì½ê¸°": "â†’ í•œ í˜ì´ì§€ë¼ë„...",
      "í”Œë­í¬ 1ë¶„+ê°„ë‹¨ ìŠ¤íŠ¸ë ˆì¹­": "â†’ ëª¸ì„ ì›€ì§ì—¬ë¼!",
      "ë¶€ê¸°ìŠ¤/ë¸”ë¡œê·¸": "â†’ ì±… ë“±ë¡/ë¸”ë¡œê·¸ ì—…ë¡œë“œ/ì¸ìŠ¤íƒ€ ì—…ë¡œë“œ/ë¦¬ë·° ë‹µê¸€ ë­ë“  ì œë°œ!",
      "ë‹¬ë¦¬ê¸°": "â†’ 5ë¶„ì´ë¼ë„! ê¾¸ì¤€íˆê°€ ì¤‘ìš”í•œ ê±° ì•Œì§€",
      "CBT ë¬¸ì œ í’€ê¸°": "â†’ ìê²©ì¦ ë”°ì•¼ì œ.."
    };

    // ë“±ê¸‰ ì„¤ì •
    const taskTier = {
      "ë‹¬ë¦¬ê¸°": "S",
      "ë¶€ê¸°ìŠ¤/ë¸”ë¡œê·¸": "S",
      "ì±… ì½ê¸°": "A",
      "CBT ë¬¸ì œ í’€ê¸°": "A",
      "Brilliant": "B",
      "í”Œë­í¬ 1ë¶„+ê°„ë‹¨ ìŠ¤íŠ¸ë ˆì¹­": "B",
      "ë“€ì˜¤ë§ê³ ": "B"
    };

    const tierLabel = {
      "S": "Sê¸‰",
      "A": "Aê¸‰",
      "B": "Bê¸‰"
    };

    // ì½”ì¸ ê¸°ë³¸ ë³´ìƒ
    const baseReward = {
      "S": 3,
      "A": 2,
      "B": 1,
      "BONUS": 0
    };

    const today = new Date().toISOString().slice(0, 10);

    // ëœë¤ ë²„í”„/ë””ë²„í”„ ëª©ë¡
    const dailyEvents = [
      {
        id: "buff_all_plus1",
        label: "ì˜¤ëŠ˜ì˜ ë²„í”„: ëª¨ë“  ë¯¸ì…˜ ì½”ì¸ +1!",
        type: "buff"
      },
      {
        id: "buff_s_plus1",
        label: "ì˜¤ëŠ˜ì˜ ë²„í”„: Sê¸‰ ë¯¸ì…˜ ì½”ì¸ +1!",
        type: "buff"
      },
      {
        id: "nerf_s_minus1",
        label: "ì˜¤ëŠ˜ì˜ ë””ë²„í”„: Sê¸‰ ë¯¸ì…˜ ì½”ì¸ -1â€¦",
        type: "debuff"
      },
      {
        id: "half_day_full",
        label: "ì˜¤ëŠ˜ì˜ íŠ¹ìˆ˜: 4ê°œë§Œ ì™„ë£Œí•´ë„ 'ì™„ë£Œí•œ ë‚ 'ë¡œ ì¸ì •!",
        type: "special"
      }
    ];

    function loadTaskStatus() {
      const stored = JSON.parse(localStorage.getItem("taskStatus"));
      const storedDate = localStorage.getItem("taskDate");

      if (!stored || storedDate !== today) {
        const reset = {};
        tasks.forEach(t => reset[t] = false);
        localStorage.setItem("taskStatus", JSON.stringify(reset));
        localStorage.setItem("taskDate", today);
        return reset;
      }
      return stored;
    }

    function loadFullDays() {
      const count = parseInt(localStorage.getItem("fullCompleteCount") || "0", 10);
      const lastDate = localStorage.getItem("fullCompleteDate") || "";
      return { count, lastDate };
    }

    function loadCoins() {
      return parseInt(localStorage.getItem("coinCount") || "0", 10);
    }

    function loadDailyEvent() {
      const storedId = localStorage.getItem("dailyEventId");
      const storedDate = localStorage.getItem("dailyEventDate");

      if (!storedId || storedDate !== today) {
        const event = dailyEvents[Math.floor(Math.random() * dailyEvents.length)];
        localStorage.setItem("dailyEventId", event.id);
        localStorage.setItem("dailyEventDate", today);
        return event;
      } else {
        const found = dailyEvents.find(e => e.id === storedId);
        return found || dailyEvents[0];
      }
    }

    let taskStatus = loadTaskStatus();
    let { count: fullCompleteCount, lastDate: fullCompleteDate } = loadFullDays();
    let coinCount = loadCoins();
    let dailyEvent = loadDailyEvent();
    let isPicking = false;
    let hasShownProgress = false;
    let currentTask = null;
    let currentTier = null;

    function getLevel(percent) {
      // 0% -> LV 1, 100% -> LV 10
      const lvl = Math.floor(percent / 10) + 1;
      return Math.min(10, Math.max(1, lvl));
    }

    function getRewardForTask(taskName) {
      const tier = taskTier[taskName] || "B";
      let reward = baseReward[tier];

      // ë³´ë„ˆìŠ¤ëŠ” ê¸°ë³¸ 0, ì´ë²¤íŠ¸ ì˜í–¥ë„ ë°›ì§€ ì•Šê²Œ ìœ ì§€
      if (tier === "BONUS") return 0;

      if (dailyEvent.id === "buff_all_plus1" && reward > 0) {
        reward += 1;
      }
      if (dailyEvent.id === "buff_s_plus1" && tier === "S") {
        reward += 1;
      }
      if (dailyEvent.id === "nerf_s_minus1" && tier === "S") {
        reward = Math.max(0, reward - 1);
      }

      return reward;
    }

    function updateUI() {
      const completed = Object.values(taskStatus).filter(v => v).length;

      // ì˜¤ëŠ˜ì„ "ì™„ë£Œí•œ ë‚ "ë¡œ ì¸ì •í•˜ëŠ” ê¸°ì¤€
      let fullNeeded = tasks.length;
      if (dailyEvent.id === "half_day_full") {
        fullNeeded = Math.ceil(tasks.length / 2); // 4ê°œ ì´ìƒì´ë©´ í•˜ë£¨ ì¸ì •
      }

      if (completed >= fullNeeded && fullCompleteDate !== today) {
        fullCompleteCount += 1;
        fullCompleteDate = today;
        localStorage.setItem("fullCompleteCount", String(fullCompleteCount));
        localStorage.setItem("fullCompleteDate", fullCompleteDate);
      }

      // ì˜¤ëŠ˜ ì§„í–‰ë„
      document.getElementById("progressText").textContent =
        `ì˜¤ëŠ˜ ì™„ë£Œ: ${completed} / ${tasks.length}`;

      const circle = "â—".repeat(completed) + "â—‹".repeat(tasks.length - completed);
      document.getElementById("progressBar").textContent = circle;

      const listEl = document.getElementById("checkboxList");
      listEl.innerHTML = "";
      tasks.forEach(t => {
        const div = document.createElement("div");
        div.textContent = (taskStatus[t] ? "âœ” " : "â–¡ ") + t;
        listEl.appendChild(div);
      });

      // ì—°ê°„ í¼ì„¼íŠ¸ + ë ˆë²¨
      const percent = Math.min(100, (fullCompleteCount / 365) * 100);
      const level = getLevel(percent);

      document.getElementById("streakText").textContent =
        `ì˜¬í•´ ì „ë¶€ ë‹¤ í•œ ë‚ : ${fullCompleteCount}ì¼ / 365ì¼ (${percent.toFixed(1)}%)`;
      document.getElementById("streakFill").style.width = `${percent}%`;

      // ì½”ì¸ + ë ˆë²¨ í‘œì‹œ
      document.getElementById("statusSummary").textContent =
        `ì½”ì¸: ${coinCount}ê°œ Â· LV ${level}`;

      // ì˜¤ëŠ˜ì˜ ë²„í”„/ë””ë²„í”„ í‘œì‹œ
      document.getElementById("eventText").textContent = dailyEvent.label;
    }

    function showProgressIfNeeded() {
      if (!hasShownProgress) {
        document.getElementById("progressContainer").style.display = "block";
        hasShownProgress = true;
      }
    }

    // ì£¼ê°„ í…Œë§ˆ ì ìš© (í…ìŠ¤íŠ¸ëŠ” ì´ëª¨ì§€ ì•„ì´ì½˜ë§Œ)
    function applyTheme() {
      const date = new Date();
      const yearStart = new Date(date.getFullYear(), 0, 1);
      const diffDays = Math.floor((date - yearStart) / 86400000);
      const weekNumber = Math.floor(diffDays / 7);
      const themes = [
        { emoji: "ğŸ±", bodyBg: "#fdf6f0" },
        { emoji: "ğŸŒ²", bodyBg: "#f0f7f4" },
        { emoji: "ğŸŒŒ", bodyBg: "#050816" }
      ];
      const theme = themes[weekNumber % themes.length];

      document.getElementById("themeLabel").textContent = theme.emoji;
      document.body.style.background = theme.bodyBg;
    }

    applyTheme();
    updateUI(); // ë°ì´í„°ëŠ” ë¯¸ë¦¬ ì¤€ë¹„í•´ë‘ê³ , í™”ë©´ì€ ì²« ê²°ê³¼ ì´í›„ì—ë§Œ í‘œì‹œë¨

    function pickRandom() {
      if (isPicking) return;
      isPicking = true;

      const pickBtn = document.getElementById("pickButton");
      const resultEl = document.getElementById("result");
      const hintEl = document.getElementById("hint");

      pickBtn.disabled = true;
      pickBtn.textContent = "ê³ ë¥´ëŠ” ì¤‘...";

      document.getElementById("actionButtons").style.display = "none";
      resultEl.classList.remove("s-glow");

      const available = tasks.filter(t => !taskStatus[t]);

      if (available.length === 0) {
        resultEl.textContent = "ì˜¤ëŠ˜ í•  ì¼ ì™„ë£Œ!";
        hintEl.textContent = "";
        pickBtn.disabled = false;
        pickBtn.textContent = "ì§€ê¸ˆ ë‹¹ì¥ ì´ê±°!";
        isPicking = false;
        showProgressIfNeeded();
        return;
      }

      // ê³ ë¯¼ ì¤‘... ì• ë‹ˆë©”ì´ì…˜
      let dots = 0;
      resultEl.textContent = "ê³ ë¯¼ ì¤‘";
      hintEl.textContent = "2ì´ˆë§Œ ê¸°ë‹¤ë ¤ì¤˜â€¦";
      const loading = setInterval(() => {
        dots = (dots + 1) % 4;
        resultEl.textContent = "ê³ ë¯¼ ì¤‘" + ".".repeat(dots);
      }, 400);

      setTimeout(() => {
        clearInterval(loading);

        const finalChoice = available[Math.floor(Math.random() * available.length)];
        const finalTier = taskTier[finalChoice] || "B";

        currentTask = finalChoice;
        currentTier = finalTier;

        const label = tierLabel[finalTier] || "Bê¸‰";
        const badge = `<span class="tier-label">${label}</span>`;
        const safeText = finalChoice.replace(/</g, "&lt;").replace(/>/g, "&gt;");
        resultEl.innerHTML = `${badge}${safeText}`;

        const baseHint = hints[finalChoice] || "";
        if (finalTier === "S") {
          resultEl.classList.add("s-glow");
          hintEl.textContent = `âœ¨ Sê¸‰ ë¯¸ì…˜ ë“±ì¥! âœ¨ ${baseHint}`;
        } else {
          hintEl.textContent = baseHint;
        }

        document.getElementById("actionButtons").style.display = "flex";

        pickBtn.disabled = false;
        pickBtn.textContent = "ì§€ê¸ˆ ë‹¹ì¥ ì´ê±°!";
        isPicking = false;

        showProgressIfNeeded();
      }, 2000);
    }

    function markComplete() {
      if (!currentTask || !tasks.includes(currentTask)) return;

      if (taskStatus[currentTask]) {
        document.getElementById("hint").textContent = "ì´ë¯¸ ì™„ë£Œí•œ ë¯¸ì…˜ì´ì—ìš”!";
        hideButtons();
        return;
      }

      taskStatus[currentTask] = true;
      localStorage.setItem("taskStatus", JSON.stringify(taskStatus));

      const reward = getRewardForTask(currentTask);
      if (reward > 0) {
        coinCount += reward;
        localStorage.setItem("coinCount", String(coinCount));
        document.getElementById("hint").textContent =
          `ì™„ë£Œ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤! (+${reward}ì½”ì¸)`;
      } else {
        document.getElementById("hint").textContent =
          "ì™„ë£Œ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!";
      }

      hideButtons();
      updateUI();
    }

    function hideButtons() {
      document.getElementById("actionButtons").style.display = "none";
    }
  </script>
</body>
</html>
